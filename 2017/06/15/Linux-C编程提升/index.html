<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Linux C编程提升 | Linux开发笔记</title>
  <meta name="author" content="lxl2015">
  
  <meta name="description" content="一、编程提升">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Linux C编程提升"/>
  <meta property="og:site_name" content="Linux开发笔记"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="alternate" href="/atom.xml" title="Linux开发笔记" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <!-- wumiiVerification -->
  <!-- meta name="wumiiVerification" content="fb50a101-84fe-4ca2-91a7-ae8cf792978b" /-->
  <!-- meta name="wumiiVerification" content="d73b5866-c390-4156-a4dd-51b526b5335e" /-->
  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!-- Font-Awesome -->
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <header id="header"><div class= "header-content inner">
	<div class = "alignleft col-one">
		
			<div class='avatar'>
				<img src = "/img/default/avatar.gif">
              </div>
		
		<div class="header-div">
		    <h1><a href="/">Linux开发笔记</a></h1>
		    <h2><a href="/"></a></h2>
		</div>
	</div>
	<div class = "alignright col-two">
		
	</div>
	<div class="clearfix"></div>
</div>

<div class= "header-nav">
	<div class='header-nav-content inner'>
		<div id="main-nav" class="alignleft">
		    		
		    		  <a href="/"><i class="fa fa-home"></i>首页</a>
		    		
		    		  <a href="/archives"><i class="fa fa-archive"></i>归档</a>
		    		
		    		  <a href="/resume"><i class="fa fa-user"></i>关于我</a>
		    		
		</div>
		<div id="sub-nav" class="alignright">
		    
		</div>
	</div>
	<div class="clearfix"></div>
</div>
</header>
  
    <div id="content" class="inner">
      <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2017-06-15T14:20:54.000Z"><a href="/2017/06/15/Linux-C编程提升/">2017-06-15</a></time>
        
  
    <h1 class="title">Linux C编程提升</h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%BC%96%E7%A8%8B%E6%8F%90%E5%8D%87"><span class="toc-text">一、编程提升</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%87%BD%E6%95%B0%E6%9D%A1%E4%BB%B6%E7%BC%96%E8%AF%91"><span class="toc-text">1、函数条件编译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E3%80%81-if%E3%80%81-elif%E3%80%81-else%E5%92%8C-endif"><span class="toc-text">1.1、#if、#elif、#else和#endif</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1%E3%80%81%E6%96%B9%E5%BC%8F1"><span class="toc-text">1.1.1、方式1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2%E3%80%81%E6%96%B9%E5%BC%8F2"><span class="toc-text">1.1.2、方式2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E3%80%81-ifdef-else-endif"><span class="toc-text">1.2、#ifdef #else #endif</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3%E3%80%81-ifndef-else-endif"><span class="toc-text">1.3、#ifndef #else #endif</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4%E3%80%81-udef"><span class="toc-text">1.4、#udef</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81typedef%E4%B8%80%E4%BA%9B%E7%94%A8%E6%B3%95"><span class="toc-text">2、typedef一些用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81%E9%87%8D%E5%91%BD%E4%BB%A4"><span class="toc-text">2.1、重命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81%E8%B7%A8%E5%B9%B3%E5%8F%B0"><span class="toc-text">2.2、跨平台</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3%E3%80%81%E7%94%A8%E5%81%9A%E5%9B%9E%E6%8E%89%E5%87%BD%E6%95%B0"><span class="toc-text">2.3、用做回掉函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81define%E7%9A%84%E4%B8%80%E4%BA%9B%E7%94%A8%E6%B3%95"><span class="toc-text">3、define的一些用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81define%E4%B8%AD%E7%9A%84%E4%B8%A4%E4%B8%AA%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7%EF%BC%9A-%EF%BC%8C"><span class="toc-text">3.1、define中的两个特殊符号：#，##</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E3%80%81%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E5%AE%8F-VA-ARGS"><span class="toc-text">3.3、可变参数宏__VA_ARGS__</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4%E3%80%81%E5%B8%B8%E7%94%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%8F"><span class="toc-text">3.4、常用的一些宏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4%E3%80%81%E5%86%85%E7%BD%AE%E5%AE%8F"><span class="toc-text">3.4、内置宏</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#C%E8%B0%83%E7%94%A8C-%E5%BA%93"><span class="toc-text">C调用C++库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#C-%E8%B0%83%E7%94%A8C%E5%BA%93"><span class="toc-text">C++调用C库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E8%AE%BE%E8%AE%A1%E6%8A%80%E5%B7%A7"><span class="toc-text">4、设计技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E3%80%81%E6%9F%94%E6%80%A7%E6%95%B0%E7%BB%84"><span class="toc-text">4.1、柔性数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E3%80%81typeof"><span class="toc-text">4.2、typeof</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E3%80%81C%E7%BC%96%E7%A8%8B%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA%EF%BC%8C%E8%A1%A5%E5%85%A80"><span class="toc-text">4.3、C编程格式化输出，补全0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E7%9B%AE%E8%BF%90%E7%AE%97%E7%AC%A6%E5%B5%8C%E5%A5%97"><span class="toc-text">三目运算符嵌套</span></a></li></ol></li></ol></li></ol>
    </div>

        <h1 id="一、编程提升"><a href="#一、编程提升" class="headerlink" title="一、编程提升"></a>一、编程提升</h1><span id="more"></span>

<h2 id="1、函数条件编译"><a href="#1、函数条件编译" class="headerlink" title="1、函数条件编译"></a>1、函数条件编译</h2><h3 id="1-1、-if、-elif、-else和-endif"><a href="#1-1、-if、-elif、-else和-endif" class="headerlink" title="1.1、#if、#elif、#else和#endif"></a>1.1、#if、#elif、#else和#endif</h3><h4 id="1-1-1、方式1"><a href="#1-1-1、方式1" class="headerlink" title="1.1.1、方式1"></a>1.1.1、方式1</h4><pre><code>#if 常量表达式
    程序1
#endif
</code></pre>
<h4 id="1-1-2、方式2"><a href="#1-1-2、方式2" class="headerlink" title="1.1.2、方式2"></a>1.1.2、方式2</h4><pre><code>#if 常量表达式1
    程序1
#elif defined(常量表达式2)
    程序2
。。。
#elif defined(常量表达式n)
    程序n
#else
    程序
#endif
</code></pre>
<p>功能：当常量表达式n为非0（”逻辑真时”）时，编译程序n。</p>
<p>常量表达式：可以是逻辑运算符”!”、”==”、”!=”和”||”</p>
<pre><code>#include &lt;stdio.h&gt;

#define TEST002
static void test001()
&#123;
    printf(&quot;test001\n&quot;);
&#125;

static void test002()
&#123;
    printf(&quot;test002\n&quot;);
&#125;

static void test003()
&#123;
    printf(&quot;test003\n&quot;);
&#125;

int main(int argc, const char *argv[])
&#123;
#if TEST001
    test001();
#elif defined(TEST002)
    test002();
#endif

#if !defined(TT)
    test003();
#endif
    return 0;
&#125;
</code></pre>
<h3 id="1-2、-ifdef-else-endif"><a href="#1-2、-ifdef-else-endif" class="headerlink" title="1.2、#ifdef #else #endif"></a>1.2、#ifdef #else #endif</h3><pre><code>#ifdef 宏
    程序1
#else
    程序2
#endif
</code></pre>
<p>如果宏被定义，运行程序1，否则运行程序2</p>
<p>eg:</p>
<pre><code>#include &lt;stdio.h&gt;
//#define __DEBUG
int main(int argc, const char *argv[])
&#123;
#ifdef __DEBUG
    printf(&quot;TTTT\n&quot;);
#else
    printf(&quot;SSSS\n&quot;);
#endif
    return 0;
&#125;
</code></pre>
<h3 id="1-3、-ifndef-else-endif"><a href="#1-3、-ifndef-else-endif" class="headerlink" title="1.3、#ifndef #else #endif"></a>1.3、#ifndef #else #endif</h3><pre><code>#ifndef 宏
    程序1
#else
    程序2
#endif
</code></pre>
<p>如果宏没有被定义，则运行程序1，否则运行程序2</p>
<pre><code>#include &lt;stdio.h&gt;
//#define __DEBUG
int main(int argc, const char *argv[])
&#123;
#ifndef __DEBUG
        printf(&quot;TTTT\n&quot;);
#else
        printf(&quot;SSSS\n&quot;);
#endif
    return 0;
&#125;
</code></pre>
<h3 id="1-4、-udef"><a href="#1-4、-udef" class="headerlink" title="1.4、#udef"></a>1.4、#udef</h3><pre><code>/*
    file.c
*/
#include &lt;stdio.h&gt;
#ifdef printf
#   undef printf
#endif
#define printf  &quot;Don&#39;t use printf&quot;

int main(int argc, const char *argv[])
&#123;
    printf(&quot;Hello World.&quot;);
    return 0;
&#125;

# gcc file.c -o file
# ./file
file.c: In function ‘main’:
file.c:9: error: called object ‘&quot;Don\&#39;t use printf&quot;’ is not a function
</code></pre>
<h2 id="2、typedef一些用法"><a href="#2、typedef一些用法" class="headerlink" title="2、typedef一些用法"></a>2、typedef一些用法</h2><h3 id="2-1、重命令"><a href="#2-1、重命令" class="headerlink" title="2.1、重命令"></a>2.1、重命令</h3><p>重命名之后，程序看起来更简洁</p>
<pre><code>typedef unsigned char uchar;

typedef struct
&#123;
    int t1;
    double e1;
&#125;di_st，*p_di_st;
</code></pre>
<p>使用的时候直接这样用。</p>
<pre><code>p_di_st p = NULL;
p = malloc(sizeof(di_st));
</code></pre>
<h3 id="2-2、跨平台"><a href="#2-2、跨平台" class="headerlink" title="2.2、跨平台"></a>2.2、跨平台</h3><p>用typedef来定义与平台无关的类型。</p>
<pre><code>#if defined(SOCKET) || defined(_WINDOWS)
typedef SOCKET    XXX_SOCKET;
#else
typedef int    XXX_SOCKET;
#endif
</code></pre>
<p>例如Windows使用的套接字类型和Linux不一样。</p>
<h3 id="2-3、用做回掉函数"><a href="#2-3、用做回掉函数" class="headerlink" title="2.3、用做回掉函数"></a>2.3、用做回掉函数</h3><pre><code>/*************************************************************************
    &gt; File Name: call.c
    &gt; Author: Lin
    &gt; Mail: 不想写邮箱
    &gt; Created Time: Thu 15 Jun 2017 10:25:11 AM CST
 ************************************************************************/

#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;

typedef void (*call_back_t)(void *);

void test(void *str)
&#123;
    printf(&quot;%s\n&quot;,(char *)str);
&#125;

void hhh(call_back_t c,void *p)
&#123;
    c(p);
&#125;

int main(int argc, const char *argv[])
&#123;
    char *a = &quot;1234678&quot;;
    hhh(&amp;test,(void *)a);    
    return 0;
&#125;
</code></pre>
<hr>
<pre><code># gcc call.c -o call
# ./call
12345678
</code></pre>
<h2 id="3、define的一些用法"><a href="#3、define的一些用法" class="headerlink" title="3、define的一些用法"></a>3、define的一些用法</h2><h3 id="3-1、define中的两个特殊符号：-，"><a href="#3-1、define中的两个特殊符号：-，" class="headerlink" title="3.1、define中的两个特殊符号：#，##"></a>3.1、define中的两个特殊符号：#，##</h3><p>连接字符串和连接数字 ##</p>
<pre><code>#include &lt;stdio.h&gt;

#define CONN(x,y)  #x#y        //连接字符串
#define NCONN(x,y) x##y        //连接数字
int main(int argc, const char *argv[])
&#123;
    int n = NCONN(123,456);
    char* str = CONN(abc,def);

    printf(&quot;n = %d\n&quot;,n);
    printf(&quot;str = %s\n&quot;,str);
    return 0;
&#125;
</code></pre>
<p>高级使用方法1:</p>
<pre><code>/*************************************************************************
    &gt; File Name: define.h
    &gt; Author: Lin
    &gt; Mail: 不想写邮箱
    &gt; Created Time: Wed 14 Jun 2017 02:48:22 PM CST
 ************************************************************************/

#ifndef _DEFINE_H
#define _DEFINE_H

#define MEM_FUNC_MALLOC(__prefix)                   \
static void * __prefix ## _mem_malloc(size_t size)  \
&#123;                                                   \
    return malloc(size);                            \
&#125;

#define MEM_FUNC_FREE(__prefix)                     \
static void __prefix ## _mem_free(void *p)          \
&#123;                                                   \
    free(p);                                        \
&#125;

#define MEM_FUNC(__prefix)                          \
MEM_FUNC_MALLOC(__prefix)                           \
MEM_FUNC_FREE(__prefix)                             
#endif
</code></pre>
<hr>
<pre><code>/*************************************************************************
    &gt; File Name: define.c
    &gt; Author: Lin
    &gt; Mail: 不想写邮箱
    &gt; Created Time: Wed 14 Jun 2017 02:53:11 PM CST
 ************************************************************************/

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &quot;define.h&quot;

MEM_FUNC(test1)
MEM_FUNC(test2)

int main(int argc, const char *argv[])
&#123;
    char *tmp1,*tmp2;

    tmp1 = test1_mem_malloc(100);
    memset(tmp1,0,100);
    strcpy(tmp1,&quot;Hello World!&quot;);
    printf(&quot;tmp1 = %s\n&quot;,tmp1);
    test1_mem_free(tmp1);

    tmp2 = test2_mem_malloc(100);
    memset(tmp2,0,100);
    strcpy(tmp2,&quot;Hello Kitty!&quot;);
    printf(&quot;tmp2 = %s\n&quot;,tmp2);
    test2_mem_free(tmp2);

    return 0;
&#125;
</code></pre>
<hr>
<pre><code># gcc  define.c -o define
# ./define
tmp1 = Hello World!
tmp2 = Hello Kitty!
</code></pre>
<p>检查一下内存是否泄露</p>
<pre><code># valgrind --leak-check=full ./define
==18702== Memcheck, a memory error detector
==18702== Copyright (C) 2002-2012, and GNU GPL&#39;d, by Julian Seward et al.
==18702== Using Valgrind-3.8.1 and LibVEX; rerun with -h for copyright info
==18702== Command: ./define
==18702== 
tmp1 = Hello World!
tmp2 = Hello Kitty!
==18702== 
==18702== HEAP SUMMARY:
==18702==     in use at exit: 0 bytes in 0 blocks
==18702==   total heap usage: 2 allocs, 2 frees, 200 bytes allocated
==18702== 
==18702== All heap blocks were freed -- no leaks are possible
==18702== 
==18702== For counts of detected and suppressed errors, rerun with: -v
==18702== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 6 from 6)
</code></pre>
<p>高级用法2</p>
<pre><code>#include &lt;stdio.h&gt;

# define DEFINE_S(name,type1,type2) \
typedef struct test_ ## name        \
&#123;                                   \
    type1 t1;                       \
    type2 t2;                       \
&#125;test_ ## name ## _t;

int main(int argc, const char *argv[])
&#123;
    DEFINE_S(tt1,int,char);
    DEFINE_S(tt2,float,double);

    test_tt1_t ttt1;
    ttt1.t1 = 100;
    ttt1.t2 = &#39;\n&#39;;
    
    printf(&quot;ttt1 t1:%d,t2:%c\n&quot;,ttt1.t1,ttt1.t2);

    test_tt2_t ttt2;
    ttt2.t1 = 1.11;
    ttt2.t2 = 3.1;
    printf(&quot;ttt2 t1:%f,t2:%f\n&quot;,ttt2.t1,ttt2.t2);

    return 0;
&#125;
</code></pre>
<p>高级用法3</p>
<pre><code>/*************************************************************************
    &gt; File Name: 2.c
    &gt; Author: Lin
    &gt; Mail: 不想写邮箱
    &gt; Created Time: Thu 15 Jun 2017 11:17:49 AM CST
 ************************************************************************/

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

#define THREAD_ENTRY_POINTER(pointer_name)  \
    unsigned pointer_name(void *)

#define THREAD_ENTRY(entry_name,arg_name)   \
    unsigned entry_name(void *arg_name)


THREAD_ENTRY(test_loop,args)
&#123;
    printf(&quot;\n%d\n&quot;,*((int *)args));
&#125;


int test_start(THREAD_ENTRY_POINTER(hander),void *args)
&#123;
    (*hander)(args);
    return 0;
&#125;


int main(int argc, const char *argv[])
&#123;
    int args = 100;
    test_start(test_loop,&amp;args);
    return 0;
&#125;
</code></pre>
<p>等等很多。</p>
<p>转化为字符串#</p>
<pre><code>#include &lt;stdio.h&gt;
#define TOSTR(x) #x    
int main(int argc, const char *argv[])
&#123;
    printf(&quot;%s\n&quot;,TOSTR(abcd));
    return 0;
&#125;
</code></pre>
<h3 id="3-3、可变参数宏-VA-ARGS"><a href="#3-3、可变参数宏-VA-ARGS" class="headerlink" title="3.3、可变参数宏__VA_ARGS__"></a>3.3、可变参数宏__VA_ARGS__</h3><p>__VA_ARGS__可以接受可变数目的参数</p>
<pre><code>#include &lt;stdio.h&gt;
#define VAA(...) printf(__VA_ARGS__) 
int main(int argc, const char *argv[])
&#123;
    int tmp1 = 10;
    float tmp2 = 1.123;
    VAA(&quot;hello\n&quot;);
    VAA(&quot;tmp1 = %d, tmp2 = %f\n&quot;,tmp1,tmp2);
    return 0;
&#125;
</code></pre>
<p>运行结果<br>    hello<br>    tmp1 = 10, tmp2 = 1.123000</p>
<h3 id="3-4、常用的一些宏"><a href="#3-4、常用的一些宏" class="headerlink" title="3.4、常用的一些宏"></a>3.4、常用的一些宏</h3><pre><code>//判断最小值
# define MIN(a, b) ((a) &lt; (b) ? (a) : (b))
//判断最大值
# define MAX(a, b) ((a) &gt; (b) ? (a) : (b))
</code></pre>
<p>得到一个field在结构体(struct)中的偏移量</p>
<pre><code># define OFFSETOF( type, field ) ( (size_t) &amp;(( type *) 0)-&gt; field )
</code></pre>
<p>得到一个结构体中field所占用的字节数 </p>
<pre><code># define FSIZ( type, field ) sizeof( ((type *) 0)-&gt;field )
</code></pre>
<p>将一个字母转换为大写</p>
<pre><code># define UPCASE( c ) ( ((c) &gt;= &#39;&#39;a&#39;&#39; &amp;&amp; (c) &lt;= &#39;&#39;z&#39;&#39;) ? ((c) - 0x20) : (c) )
</code></pre>
<p>判断字符是不是10进值的数字</p>
<pre><code># define DECCHK( c ) ((c) &gt;= &#39;&#39;0&#39;&#39; &amp;&amp; (c) &lt;= &#39;&#39;9&#39;&#39;)
</code></pre>
<p>判断字符是不是16进值的数字 </p>
<pre><code># define HEXCHK( c ) ( ((c) &gt;= &#39;&#39;0&#39;&#39; &amp;&amp; (c) &lt;= &#39;&#39;9&#39;&#39;) ||((c) &gt;= &#39;&#39;A&#39;&#39; &amp;&amp; (c) &lt;= &#39;&#39;F&#39;&#39;) ||((c) &gt;= &#39;&#39;a&#39;&#39; &amp;&amp; (c) &lt;= &#39;&#39;f&#39;&#39;) )
</code></pre>
<p>防止溢出的一个方法</p>
<pre><code># define INC_SAT( val ) (val = ((val)+1 &gt; (val)) ? (val)+1 : (val))
</code></pre>
<p>返回数组元素的个数 </p>
<pre><code># define ARR_SIZE( a ) ( sizeof( (a) ) / sizeof( *a ) )
</code></pre>
<p>简单数学计算（绝对值，三角函数等）</p>
<pre><code># define ABS( a ) ( ((a)&gt;0) ? (a) : (-(a)) )  
</code></pre>
<p>define 一个复杂语句</p>
<pre><code># define xxx_free(ptr)        \
    \
do                \
&#123;                \
    if (ptr)        \
    &#123;            \
        free(ptr);    \
        ptr = NULL;    \
    &#125;            \
&#125;                \
while (0)

# define xxx_fclose(file)    \
    \
do                \
&#123;                \
    if (file)        \
    &#123;            \
        fclose(file);    \
        file = NULL;    \
    &#125;            \
&#125;    
</code></pre>
<h3 id="3-4、内置宏"><a href="#3-4、内置宏" class="headerlink" title="3.4、内置宏"></a>3.4、内置宏</h3><p>ANSI C标准中有几个标准预定义宏</p>
<pre><code>__func__：在源代码中插入当前所在函数名；
__LINE__：在源代码中插入当前源代码行号；
__FILE__：在源文件中插入当前源文件名；
__DATE__：在源文件中插入当前的编译日期
__TIME__：在源文件中插入当前编译时间；
__STDC__：当要求程序严格遵循ANSI C标准时该标识被赋值为1；
__cplusplus：当编写C++程序时该标识符被定义。
</code></pre>
<p>__func__</p>
<pre><code>//func.c
#include &lt;stdio.h&gt;
int main(int argc,const char *argv[])
&#123;
    printf(&quot;name:%s\n&quot;,__func__);
&#125;

# gcc func.c -o func
# ./func
main
</code></pre>
<p>__LINE__和__FILE__</p>
<pre><code>/*************************************************************************
    &gt; File Name: line.c
    &gt; Author: Lin
    &gt; Mail: 不想写邮箱
    &gt; Created Time: Wed 14 Jun 2017 04:32:54 PM CST
 ************************************************************************/

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

#define test_malloc(size)   __test_malloc(__FILE__,__LINE__,size)
#define test_free(p)        __test_free(__FILE__,__LINE__,p)

static void * __test_malloc(const char *name,int line,size_t size)
&#123;
    printf(&quot;name:%s,line:%d\n&quot;,name,line);
    return malloc(size);
&#125;

static void __test_free(const char *name,int line,void *p)
&#123;
    printf(&quot;name:%s,line:%d\n&quot;,name,line);
    free(p);
&#125;


int main(int argc, const char *argv[])
&#123;
    char *t = test_malloc(100);
    test_free(t);
    return 0;
&#125;
</code></pre>
<hr>
<pre><code># gcc line.c  -o line
# ./line 
name:line.c,line:29
name:line.c,line:30
# valgrind --leak-check=full ./line
==20458== Memcheck, a memory error detector
==20458== Copyright (C) 2002-2012, and GNU GPL&#39;d, by Julian Seward et al.
==20458== Using Valgrind-3.8.1 and LibVEX; rerun with -h for copyright info
==20458== Command: ./line
==20458== 
name:line.c,line:29
name:line.c,line:30
==20458== 
==20458== HEAP SUMMARY:
==20458==     in use at exit: 0 bytes in 0 blocks
==20458==   total heap usage: 1 allocs, 1 frees, 100 bytes allocated
==20458== 
==20458== All heap blocks were freed -- no leaks are possible
==20458== 
==20458== For counts of detected and suppressed errors, rerun with: -v
==20458== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 6 from 6)
</code></pre>
<p>__cplusplus C/C++函数调用</p>
<h4 id="C调用C-库"><a href="#C调用C-库" class="headerlink" title="C调用C++库"></a>C调用C++库</h4><p>先写一个CPP静态库</p>
<pre><code>/*************************************************************************
    &gt; File Name: cpphello.h
    &gt; Author: Lin
    &gt; Mail: 不想写邮箱
    &gt; Created Time: Wed 14 Jun 2017 05:01:52 PM CST
 ************************************************************************/

#ifndef _CPPHELLO_H
#define _CPPHELLO_H

#ifdef __cplusplus
extern &quot;C&quot;
&#123;
#endif
    void hello(void);
#ifdef __cplusplus
&#125;
#endif
#endif
</code></pre>
<hr>
<pre><code>/*************************************************************************
    &gt; File Name: cpphello.cpp
    &gt; Author: Lin
    &gt; Mail: 不想写邮箱
    &gt; Created Time: Wed 14 Jun 2017 05:05:11 PM CST
 ************************************************************************/

#include &lt;iostream&gt;
#include &quot;cpphello.h&quot;
using namespace std;

void hello(void)
&#123;
    cout &lt;&lt; &quot;This is CPP library!&quot; &lt;&lt; endl;
&#125;

# g++ -c cpphello.cpp  -o cpphello.o
# ar -rsc libcpphello.a cpphello.o
</code></pre>
<p>写个C函数，调用CPP库</p>
<pre><code>/*************************************************************************
    &gt; File Name: hello.c
    &gt; Author: Lin
    &gt; Mail: 不想写邮箱
    &gt; Created Time: Wed 14 Jun 2017 05:07:06 PM CST
 ************************************************************************/

#include &lt;stdio.h&gt;
#include &quot;cpphello.h&quot;
int main(int argc, const char *argv[])
&#123;
    hello();
    return 0;
&#125;

# g++ hello.c  -o hello -L . libcpphello.a 
# ./hello 
This is CPP library!
</code></pre>
<h4 id="C-调用C库"><a href="#C-调用C库" class="headerlink" title="C++调用C库"></a>C++调用C库</h4><p>先写个C静态库</p>
<pre><code>/*************************************************************************
    &gt; File Name: hello.h
    &gt; Author: Lin
    &gt; Mail: 不想写邮箱
    &gt; Created Time: Wed 14 Jun 2017 05:19:21 PM CST
 ************************************************************************/

#ifndef _HELLO_H
#define _HELLO_H
#ifdef __cplusplus
extern &quot;C&quot;
#endif
void hello(void);
#endif
</code></pre>
<hr>
<pre><code>/*************************************************************************
    &gt; File Name: hello.c
    &gt; Author: Lin
    &gt; Mail: 不想写邮箱
    &gt; Created Time: Wed 14 Jun 2017 05:19:34 PM CST
 ************************************************************************/

#include &lt;stdio.h&gt;
#include &quot;hello.h&quot;
void hello(void)
&#123;
    printf(&quot;This is C library\n&quot;);
&#125;
</code></pre>
<p>写个CPP调用C库<br>    /*************************************************************************<br>        &gt; File Name: cpphello.cpp<br>        &gt; Author: Lin<br>        &gt; Mail: 不想写邮箱<br>        &gt; Created Time: Wed 14 Jun 2017 05:21:13 PM CST<br>     ************************************************************************/</p>
<pre><code>#include &lt;iostream&gt;

extern &quot;C&quot;
&#123;
#include &quot;hello.h&quot;
&#125;
using namespace std;
int main(int argc, const char *argv[])
&#123;
    hello();
    return 0;
&#125;
</code></pre>
<p>生成C静态库</p>
<pre><code># gcc -c hello.c -o hello.o
# ar -rsc libhello.a hello.o
</code></pre>
<p>CPP调用C库<br>    # g++ cpphello.cpp -o cpphello -L . libhello.a<br>    # ./cpphello<br>    This is C library</p>
<p>这只是简单的调用，详细的请点<a target="_blank" rel="noopener" href="https://isocpp.org/wiki/faq/mixing-c-and-cpp">这里</a>。稍后会有翻译文章</p>
<h2 id="4、设计技巧"><a href="#4、设计技巧" class="headerlink" title="4、设计技巧"></a>4、设计技巧</h2><h3 id="4-1、柔性数组"><a href="#4-1、柔性数组" class="headerlink" title="4.1、柔性数组"></a>4.1、柔性数组</h3><p>柔性数组<br>就是申请比较大的内存，让用户使用不超过所申请内存的数组；<br>理论这么讲：<br>结构中的最后一个元素允许是未知大小的数组，这就叫做柔性数组成员，但结构中的柔性数组成员前面必须至少一个其 他成员。柔性数组成员允许结构中包含一个大小可变的数组。sizeof返回的这种结构大小不包括柔性数组的内存。包含柔性数组成员的结构用malloc ()函数进行内存的动态分配，并且分配的内存应该大于结构的大小，以适应柔性数组的预期大小。</p>
<pre><code>/*************************************************************************
    &gt; File Name: arry.c
    &gt; Author: Lin
    &gt; Mail: 不想写邮箱
    &gt; Created Time: Tue 07 Mar 2017 02:20:56 PM CST
 ************************************************************************/
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
typedef struct _soft_arry_
&#123;
    int len;
    char arry[];
&#125;*p_soft_arry;
int main(int argc, const char *argv[])
&#123;
    char *str = &quot;Hello World!!!&quot;;
    p_soft_arry p;
    p = malloc(sizeof(struct _soft_arry_) + 100*(sizeof(char)));
    //申请一个长度为100的数组
    //
    p-&gt;len = 100;
    memset(p-&gt;arry,0,100);
    memcpy(p-&gt;arry,str,20);
    printf(&quot; soft arry:%s\n&quot;,p-&gt;arry);
    return 0;
&#125;
</code></pre>
<h3 id="4-2、typeof"><a href="#4-2、typeof" class="headerlink" title="4.2、typeof"></a>4.2、typeof</h3><p>就像sizeof（exp）返回的 是exp的数据类型大小，那么typeof（exp）返回的就是exp.的数据类型。<br>exp</p>
<pre><code>/*************************************************************************
  &gt; File Name: 2.c
  &gt; Author: Lin
  &gt; Mail: 不想写邮箱
  &gt; Created Time: Wed 08 Mar 2017 01:56:04 PM CST
 ************************************************************************/
#include &lt;stdio.h&gt;
typedef struct 
&#123;
    int x;
    char y;
&#125;astruct, * pastrcut;
int main(int argc, const char *argv[])
&#123;
    int sizem, sizew;
    int x = 3;
    typeof(&amp;x) m = &amp;x;
    sizem = sizeof(m);
    *m = 5;
    typeof(((astruct *)5)-&gt;y) w;
    sizew = sizeof(w);
    w = &#39;a&#39;;
    printf(&quot;*m = %d\n&quot;,*m);
    return 0;
&#125;
</code></pre>
<h3 id="4-3、C编程格式化输出，补全0"><a href="#4-3、C编程格式化输出，补全0" class="headerlink" title="4.3、C编程格式化输出，补全0"></a>4.3、C编程格式化输出，补全0</h3><pre><code>/*************************************************************************
  &gt; File Name: 6.c
  &gt; Author: Lin
  &gt; Mail: 不想写邮箱
  &gt; Created Time: Tue 01 Aug 2017 18:43:19 AM CST
 ************************************************************************/

#include &lt;stdio.h&gt;
int main(int argc, const char *argv[])
&#123;
    int i;
    int n = 10;
    for(i = 1; i &lt; 50; i ++)
    &#123;
        printf(&quot;%08d\t&quot;,i);
        if(i % 9 == 0)
            printf(&quot;\n&quot;);
    &#125;

    for(i = 1; i &lt; 50; i++)
    &#123;
        /*
        *    用 * 代替位数，在后面的参数列表中用变量控制输出位数；
        */
        printf(&quot;%0*d\t&quot;,n,i);
        if(i % 5 == 0)
            printf(&quot;\n&quot;);
    &#125;
    return 0;
&#125;
</code></pre>
<p>输出格式为</p>
<pre><code>00000001        00000002        00000003        00000004        00000005        00000006        00000007        00000008        00000009
00000010        00000011        00000012        00000013        00000014        00000015        00000016        00000017        00000018
00000019        00000020        00000021        00000022        00000023        00000024        00000025        00000026        00000027
00000028        00000029        00000030        00000031        00000032        00000033        00000034        00000035        00000036
00000037        00000038        00000039        00000040        00000041        00000042        00000043        00000044        00000045
00000046        00000047        00000048        00000049        0000000001      0000000002      0000000003      0000000004      0000000005
0000000006      0000000007      0000000008      0000000009      0000000010
0000000011      0000000012      0000000013      0000000014      0000000015
0000000016      0000000017      0000000018      0000000019      0000000020
0000000021      0000000022      0000000023      0000000024      0000000025
0000000026      0000000027      0000000028      0000000029      0000000030
0000000031      0000000032      0000000033      0000000034      0000000035
0000000036      0000000037      0000000038      0000000039      0000000040
0000000041      0000000042      0000000043      0000000044      0000000045
0000000046      0000000047      0000000048      0000000049       
</code></pre>
<h3 id="三目运算符嵌套"><a href="#三目运算符嵌套" class="headerlink" title="三目运算符嵌套"></a>三目运算符嵌套</h3><p>现在有ABC三个数，你查出最大值最小值中间值。</p>
<pre><code>int max,mib,mid;
if(A &gt; B)
&#123;
    if(A&gt;C)
    &#123;
        max = A;
    &#125;
&#125;

...
</code></pre>
<p>假如使用三目运算符的话，可以这样</p>
<pre><code>max = C&gt;(A&gt;B?A:B)?C:(A&gt;B?A:B);
max = A&gt;B?(A&gt;C?A:C):(B&gt;C?B:C);
</code></pre>
<p>有时候会遇见这样的嵌套</p>
<pre><code>1?1?1?10:20:30:40


1?(1?(1?10:20):30):40
</code></pre>
<p>在没有编译器优化的情况下三目运算符比If-else快，因为三目运算符还会使用额外的临时变量，它先运算后复制，If-else是直接赋值，所以速度会快，但是现在的编译器已经会把这些做优化，优化后的汇编代码是一样的，就好比i++和++i，编译优化后的汇编代码是一样的。 </p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/02-C基础/">02. C基础</a>
  </div>

        
  <div class="tags">
    <a href="/tags/Linux/">Linux</a>, <a href="/tags/C/">C</a>, <a href="/tags/Makfile/">Makfile</a>
  </div>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

  
<section id = "relate">
	
</section>




</div></div>
      <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title" id="categories">分类</h3>
     <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/01-CPP-%E5%9F%BA%E7%A1%80/">01. CPP 基础</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/02-C%E5%9F%BA%E7%A1%80/">02. C基础</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/03-Python/">03.Python</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/04-Algorithm/">04. Algorithm</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/05-Linux-Operation/">05. Linux Operation</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/06-Compile-Tools/">06. Compile Tools</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/07-Linux-Dev/">07. Linux Dev</a><span class="category-list-count">32</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/08-DataBase/">08. DataBase</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/08-Database/">08. Database</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/08-DataBase/">08.DataBase</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/09-Windows-System/">09. Windows System</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/10-Web/">10. Web</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/11-Open-Source/">11. Open Source</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/11-Open-Source/">11.Open Source</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/12-Other/">12. Other</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/12-Other/">12.Other</a><span class="category-list-count">1</span></li></ul> 
</div>
 


  
  <div class="widget tag">
    <h3 class="title">归档</h3>
	<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">公元 2020 年</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">公元 2019 年</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">公元 2018 年</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">公元 2017 年</a><span class="archive-list-count">66</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">公元 2016 年</a><span class="archive-list-count">1</span></li></ul>
  </div>

</aside>
      <div class="clearfix"></div>
    </div>
  
  <footer id="footer"><div class="footer-content inner">
  <div class="alignleft">
  
    &copy; 2021 lxl2015
    
  </div>

  
  <div class="clearfix"></div>
</div></footer>
  <script src="http://libs.baidu.com/jquery/2.1.1/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<!-- calendar widget -->




<!-- 返回顶部 -->
<div id="toTop">
	<a href="#">▲</a>
	<a href="#footer">▼</a>
</div>


<!-- fancybox -->

<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>
