<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>C 语言预定义宏 | Linux开发笔记</title>
  <meta name="author" content="lxl2015">
  
  <meta name="description" content="1、标准C语言预定义宏">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="C 语言预定义宏"/>
  <meta property="og:site_name" content="Linux开发笔记"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="alternate" href="/atom.xml" title="Linux开发笔记" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <!-- wumiiVerification -->
  <!-- meta name="wumiiVerification" content="fb50a101-84fe-4ca2-91a7-ae8cf792978b" /-->
  <!-- meta name="wumiiVerification" content="d73b5866-c390-4156-a4dd-51b526b5335e" /-->
  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!-- Font-Awesome -->
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <header id="header"><div class= "header-content inner">
	<div class = "alignleft col-one">
		
			<div class='avatar'>
				<img src = "/img/default/avatar.gif">
              </div>
		
		<div class="header-div">
		    <h1><a href="/">Linux开发笔记</a></h1>
		    <h2><a href="/"></a></h2>
		</div>
	</div>
	<div class = "alignright col-two">
		
	</div>
	<div class="clearfix"></div>
</div>

<div class= "header-nav">
	<div class='header-nav-content inner'>
		<div id="main-nav" class="alignleft">
		    		
		    		  <a href="/"><i class="fa fa-home"></i>首页</a>
		    		
		    		  <a href="/archives"><i class="fa fa-archive"></i>归档</a>
		    		
		    		  <a href="/resume"><i class="fa fa-user"></i>关于我</a>
		    		
		</div>
		<div id="sub-nav" class="alignright">
		    
		</div>
	</div>
	<div class="clearfix"></div>
</div>
</header>
  
    <div id="content" class="inner">
      <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2017-09-28T03:13:35.000Z"><a href="/2017/09/28/C-语言预定义宏/">2017-09-28</a></time>
        
  
    <h1 class="title">C 语言预定义宏</h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E6%A0%87%E5%87%86C%E8%AF%AD%E8%A8%80%E9%A2%84%E5%AE%9A%E4%B9%89%E5%AE%8F"><span class="toc-text">1、标准C语言预定义宏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81GCC%E9%A2%84%E5%AE%9A%E4%B9%89%E5%AE%8F"><span class="toc-text">2、GCC预定义宏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E8%B7%A8%E5%B9%B3%E5%8F%B0"><span class="toc-text">3、跨平台</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%B8%B8%E7%94%A8%E5%AE%8F%E5%AE%9A%E4%B9%89"><span class="toc-text">4. 常用宏定义</span></a></li></ol>
    </div>

        <h4 id="1、标准C语言预定义宏"><a href="#1、标准C语言预定义宏" class="headerlink" title="1、标准C语言预定义宏"></a>1、标准C语言预定义宏</h4><span id="more"></span>


<p>标准C语言预处理要求定义某些对象宏，每个预定义宏的名称一两个下划线字符开头和结尾，这些预定义宏不能被取消定义（#undef）或由编程人员重新定义。下面预定义宏表。</p>
<pre><code>__LINE__                        当前程序行的行号，表示为十进制整型常量
__FILE__                        当前源文件名，表示字符串型常量
__DATE__                        转换的日历日期，表示为Mmm dd yyyy 形式的字符串常量，Mmm是由asctime产生的。
__TIME__                        转换的时间，表示&quot;hh:mm:ss&quot;形式的字符串型常量，是有asctime产生的。（asctime貌似是指的一个函数）
__STDC__                        编辑器为ISO兼容实现时位十进制整型常量
__STDC_VERSION__                如何实现复合C89整部1，则这个宏的值为19940SL；如果实现符合C99，则这个宏的值为199901L；否则数值是未定义
__STDC_EOBTED__ (C99)            实现为宿主实现时为1,实现为独立实现为0
__STDC_IEC_559__ (C99)            浮点数实现复合IBC 60559标准时定义为1，否者数值是未定义
__STDC_IEC_559_COMPLEX__ (C99)    复数运算实现复合IBC 60559标准时定义为1，否者数值是未定义
__STDC_ISO_10646__ (C99)        定义为长整型常量，yyyymmL表示wchar_t值复合ISO 10646标准及其指定年月的修订补充，否则数值未定义
__cplusplus                        当使用C ++编译器时，定义此宏。您可以使用它 __cplusplus来测试头是否由C编译器或C ++编译器编译。该宏类似于__STDC_VERSION__扩展为版本号。根据所选择的语言标准，宏的价值是 199711L1998 C ++标准， 201103L2011 C ++标准， 201402L2014 C ++标准， 201703L2017 C ++标准，或严格大于201703L使用的实验语言的未指定值-std = C ++ 2a中 和 -std = GNU ++ 2a中。
</code></pre>
<h4 id="2、GCC预定义宏"><a href="#2、GCC预定义宏" class="headerlink" title="2、GCC预定义宏"></a>2、GCC预定义宏</h4><p>gcc系统特定的预定义宏</p>
<pre><code># cpp -dM /dev/null
</code></pre>
<p>生成系统特定的预定义宏，但是不建议使用</p>
<p>GCC里面常见的预定义宏地址 <a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/cpp/Common-Predefined-Macros.html#Common-Predefined-Macros">点这里</a></p>
<h4 id="3、跨平台"><a href="#3、跨平台" class="headerlink" title="3、跨平台"></a>3、跨平台</h4><p>3.1、预定义__GNUC__宏</p>
<ul>
<li> __GNUC__ 是gcc编译器编译代码时预定义的一个宏。需要针对gcc编写代码时， 可以使用该宏进行条件编译。</li>
<li> __GNUC__  的值表示gcc的版本。需要针对gcc特定版本编写代码时，也可以使用该宏进行条件编译。</li>
<li> __GNUC__  的类型是“int”，该宏被扩展后， 得到的是整数字面值。可以通过仅预处理，查看宏扩展后的文本。</li>
</ul>
<p>示例：</p>
<pre><code>//test.cpp
#include &lt;assert.h&gt;
#include &lt;stdio.h&gt;
#include &lt;typeinfo&gt;
#ifndef __GNUC__
#error sample for gcc compiler
#else
/* use gcc special extension: #warning , __attribute__, etc.  */
#endif
int main(int argc, const char *argv[])
&#123;
    
    printf(&quot;hello gcc %d\n&quot;,__GNUC__);    
    assert( typeid(__GNUC__)==typeid(int) );    
    printf(&quot;press Enter to exit\n&quot;);    
    (void)getchar();
    return 0;
&#125;

# g++ test.cpp -o test
# ./test    
hello gcc 4
press Enter to exit
</code></pre>
<p>3.2、预定义_MSC_VER宏</p>
<ul>
<li>_MSC_VER是微软C/C++编译器——cl.exe编译代码时预定义的一个宏。需要针对cl编写代码时， 可以使用该宏进行条件编译。</li>
<li>_MSC_VER的值表示cl的版本。需要针对cl特定版本编写代码时， 也可以使用该宏进行条件编译。</li>
<li>_MSC_VER的类型是”int”。该宏被扩展后，得到的是整数字面值。可以通过仅预处理， 查看宏扩展后的文本。</li>
</ul>
<p>示例：</p>
<pre><code>/*_MSC_VER.cpp */
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;typeinfo&gt;
#define TO_LITERAL(text) TO_LITERAL_(text)
#define TO_LITERAL_(text) #text
#ifndef _MSC_VER
#error sample for msvc compiler
#else
/* use msvc special extension: #pragma message,__declspec,__stdcall,etc. */
#pragma message(&quot;----------------------------------------\n&quot;)
#pragma message(&quot;----------------------------------------\n&quot;)
#pragma message(&quot;---------- hello msvc &quot; TO_LITERAL(_MSC_VER) &quot; -------------&quot;)
#pragma message(&quot;\n----------------------------------------\n&quot;)
#pragma message(&quot;----------------------------------------\n&quot;)
extern __declspec(dllimport) void __stdcall declare_but_dont_reference(void);
#endif

int main()
&#123;
    printf(&quot;hello msvc, version=%d\n&quot;, _MSC_VER);
    printf(&quot;typeof _MSC_VER=\&quot;%s\&quot;\n&quot;, typeid(_MSC_VER).name());
    system(&quot;pause&quot;); /* msvc only on windows? */
    return 0;
&#125;
</code></pre>
<p>使用vs2017编译时</p>
<pre><code>1&gt;------ 已启动全部重新生成: 项目: test, 配置: Debug Win32 ------
1&gt;D:\Program Files (x86)\Microsoft Visual Studio\2017\Community\Common7\IDE\VC\VCTargets\Microsoft.CppBuild.targets(387,5): warning MSB8028: 中间目录(Debug\)包含从另一个项目(Project1.vcxproj)共享的文件。   这会导致错误的清除和重新生成行为。
1&gt;test.cpp
1&gt;----------------------------------------
1&gt;
1&gt;----------------------------------------
1&gt;
1&gt;---------- hello msvc 1911 -------------
1&gt;
1&gt;----------------------------------------
1&gt;
1&gt;----------------------------------------
1&gt;
1&gt;**************************************************\Debug\test.exe
1&gt;tst.vcxproj -&gt; D:*********************\Debug\test.pdb (Partial PDB)
1&gt;已完成生成项目“test.vcxproj”的操作。
========== 全部重新生成: 成功 1 个，失败 0 个，跳过 0 个 ==========
</code></pre>
<p>运行</p>
<pre><code>hello msvc, version=1911
typeof _MSC_VER=&quot;int&quot;
请按任意键继续. . .
</code></pre>
<h4 id="4-常用宏定义"><a href="#4-常用宏定义" class="headerlink" title="4. 常用宏定义"></a>4. 常用宏定义</h4><p>4.1 连接</p>
<pre><code>#define conn(x,y) x##y
</code></pre>
<hr>
<ol>
<li><p>x##y : 表示x连接y</p>
<pre><code> int i = conn(123,456); /* 结果就是i=123456;*/
 char* str = conn(&quot;asdf&quot;, &quot;adf&quot;); /*结果就是 str = &quot;asdfadf&quot;;*/
</code></pre>
</li>
</ol>
<p>连接功能在函数内的使用</p>
<pre><code>/*************************************************************************
        &gt; File Name: define.h
        &gt; Author: Lin
        &gt; Mail: 不想写邮箱
        &gt; Created Time: 2017年03月14日 星期二 10时16分37秒
************************************************************************/

#ifndef _DEFINE_H
#define _DEFINE_H



#define ZBX_MEM_FUNC1_IMPL_MALLOC(__prefix)         \
static void *__prefix ## _mem_malloc(size_t size)   \
&#123;                                                   \
    return malloc(size);                            \
&#125;                                                   



#define ZBX_MEM_FUNC1_IMPL_FREE(__prefix)           \
static void __prefix ## _mem_free(void *p)          \
&#123;                                                   \
    free(p);                                        \
&#125;                                                   




#define ZBX_MEM_FUNC_IMPL(__prefix)          \
ZBX_MEM_FUNC1_IMPL_MALLOC(__prefix)          \
ZBX_MEM_FUNC1_IMPL_FREE(__prefix)            
#endif
</code></pre>
<hr>
<pre><code>/*************************************************************************
        &gt; File Name: define.c
        &gt; Author: Lin
        &gt; Mail: 不想写邮箱
        &gt; Created Time: 2017年03月14日 星期二 10时34分34秒
************************************************************************/

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &quot;define.h&quot;
ZBX_MEM_FUNC_IMPL(test1)
ZBX_MEM_FUNC_IMPL(test2)
int main(int argc, const char *argv[])
&#123;
    char *tmp1,*tmp2;
    tmp1 = test1_mem_malloc(100);
    memset(tmp1,0,100);
    strcpy(tmp1,&quot;hello world1.&quot;);
    printf(&quot;tmp1 = %s\n&quot;,tmp1);
    test1_mem_free(tmp1);
    tmp2 = test2_mem_malloc(100);
    memset(tmp2,0,100);
    strcpy(tmp2,&quot;hello world2.&quot;);
    printf(&quot;tmp2 = %s\n&quot;,tmp2);
    test2_mem_free(tmp2);
    return 0;
&#125;
</code></pre>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/02-C基础/">02. C基础</a>
  </div>

        
  <div class="tags">
    <a href="/tags/C/">C</a>, <a href="/tags/预定义宏/">预定义宏</a>, <a href="/tags/跨平台/">跨平台</a>
  </div>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

  
<section id = "relate">
	
</section>




</div></div>
      <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title" id="categories">分类</h3>
     <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/01-CPP-%E5%9F%BA%E7%A1%80/">01. CPP 基础</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/02-C%E5%9F%BA%E7%A1%80/">02. C基础</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/03-Python/">03.Python</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/04-Algorithm/">04. Algorithm</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/05-Linux-Operation/">05. Linux Operation</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/06-Compile-Tools/">06. Compile Tools</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/07-Linux-Dev/">07. Linux Dev</a><span class="category-list-count">32</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/08-DataBase/">08. DataBase</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/08-Database/">08. Database</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/08-DataBase/">08.DataBase</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/09-Windows-System/">09. Windows System</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/10-Web/">10. Web</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/11-Open-Source/">11. Open Source</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/11-Open-Source/">11.Open Source</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/12-Other/">12. Other</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/12-Other/">12.Other</a><span class="category-list-count">1</span></li></ul> 
</div>
 


  
  <div class="widget tag">
    <h3 class="title">归档</h3>
	<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">公元 2020 年</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">公元 2019 年</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">公元 2018 年</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">公元 2017 年</a><span class="archive-list-count">66</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">公元 2016 年</a><span class="archive-list-count">1</span></li></ul>
  </div>

</aside>
      <div class="clearfix"></div>
    </div>
  
  <footer id="footer"><div class="footer-content inner">
  <div class="alignleft">
  
    &copy; 2021 lxl2015
    
  </div>

  
  <div class="clearfix"></div>
</div></footer>
  <script src="http://libs.baidu.com/jquery/2.1.1/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<!-- calendar widget -->




<!-- 返回顶部 -->
<div id="toTop">
	<a href="#">▲</a>
	<a href="#footer">▼</a>
</div>


<!-- fancybox -->

<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>
